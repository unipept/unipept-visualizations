/*! unipept-visualizations 1.1.0 30-06-2016 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},_extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};!function(){function a(a,c){return this.each(function(){var d=$(this),e=d.data("vis.treemap"),f=$.extend({},d.data(),"object"===("undefined"==typeof c?"undefined":_typeof(c))&&c);e||d.data("vis.treemap",e=new b(this,a,f)),"string"==typeof c&&e[c]()})}var b=function(a,b){function c(){s=_extends({},r,o),s.width=s.width-q.right-q.left,s.height=s.height-q.top-q.bottom,d(),e(),p.reset()}function d(){var b=s.className;$(a).addClass(b),$("<style>").prop("type","text/css").html("\n                    ."+b+" {\n                        font-family: Roboto,'Helvetica Neue',Helvetica,Arial,sans-serif;\n                    }\n                    ."+b+" .node {\n                        font-size: 9px;\n                        line-height: 10px;\n                        overflow: hidden;\n                        position: absolute;\n                        text-indent: 2px;\n                        text-align: center;\n                        text-overflow: ellipsis;\n                        cursor: pointer;\n                    }\n                    ."+b+" .node:hover {\n                        outline: 1px solid white;\n                    }\n                    ."+b+" .breadcrumbs {\n                        font-size: 11px;\n                        line-height: 20px;\n                        padding-left: 5px;\n                        font-weight: bold;\n                        color: white;\n                        box-sizing: border-box;\n                    }\n                    .full-screen ."+b+" .breadcrumbs {\n                        width: 100% !important;\n                    }\n                    ."+b+" .crumb {\n                        cursor: pointer;\n                    }\n                    ."+b+" .crumb .link:hover {\n                        text-decoration: underline;\n                    }\n                    ."+b+' .breadcrumbs .crumb + .crumb::before {\n                        content: " > ";\n                        cursor: default;\n                    }\n                ').appendTo("head")}function e(){$(a).empty(),k=d3.layout.treemap().size([s.width+1,s.height+1]).padding([10,0,0,0]).value(function(a){return a.data.self_count}),l=d3.scale.ordinal().domain(t).range(d3.range(t.length).map(d3.scale.linear().domain([0,t.length-1]).range(["#104B7D","#fdffcc"]).interpolate(d3.interpolateLab))),m=d3.select(a).append("div").attr("class","breadcrumbs").style("position","relative").style("width",s.width+q.left+q.right+"px").style("height","20px").style("background-color","#FF8F00"),n=d3.select(a).append("div").style("position","relative").style("width",s.width+q.left+q.right+"px").style("height",s.height+q.top+q.bottom+"px").style("left",q.left+"px").style("top",q.top+"px")}function f(){this.style("left",function(a){return a.x+"px"}).style("top",function(a){return a.y+"px"}).style("width",function(a){return Math.max(0,a.dx-1)+"px"}).style("height",function(a){return Math.max(0,a.dy-1)+"px"})}function g(a,b){k=d3.layout.treemap().size([a+1,b+1]).padding([10,0,0,0]).value(function(a){return a.data.self_count}),p.update(j)}function h(a){var b="#000";try{b=i(d3.rgb(a))<125?"#eee":"#000"}catch(c){}return b}function i(a){return.299*a.r+.587*a.g+.114*a.b}var j,k,l,m,n,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],p={},q={top:0,right:0,bottom:0,left:0},r={height:300,width:600,className:"unipept-treemap"},s=void 0,t=["no rank","superkingdom","kingdom","subkingdom","superphylum","phylum","subphylum","superclass","class","subclass","infraclass","superorder","order","suborder","infraorder","parvorder","superfamily","family","subfamily","tribe","subtribe","genus","subgenus","species group","species subgroup","species","subspecies","varietas","forma"],u=b;d3.select("#tooltip");return p.update=function v(a){j=a;for(var b=[],c=a;c;)b.push(c),c=c.parent;b.reverse(),m.html(""),m.selectAll(".crumb").data(b).enter().append("span").attr("class","crumb").attr("title",function(a){return a.data.rank}).html(function(a){return"<span class='link'>"+a.name+"</span>"}).on("click",v);var d=n.selectAll(".node").data(k.nodes(a),function(a){return a.id});d.enter().append("div").attr("class","node").style("background",function(a){return l(a.data.rank)}).style("color",function(a){return h(l(a.data.rank))}).style("left","0px").style("top","0px").style("width","0px").style("height","0px").text(function(a){return a.name}).on("click",v).on("contextmenu",function(a){d3.event.preventDefault(),j.parent&&v(j.parent)}),d.order().transition().call(f),d.exit().remove()},p.reset=function(){p.update(u)},p.setFullScreen=function(a){setTimeout(function(){var b=s.width,c=s.height;a&&(b=$(window).width(),c=$(window).height()-44),g(b,c)},1e3)},c(),p};$.fn.treemap=a,$.fn.treemap.Constructor=b}(),function(){function a(a,c){return this.each(function(){var d=$(this),e=d.data("vis.treeview"),f=$.extend({},d.data(),"object"===("undefined"==typeof c?"undefined":_typeof(c))&&c);e||d.data("vis.treeview",e=new b(this,a,f)),"string"==typeof c&&e[c]()})}var b=function(a,b){function c(){A=_extends({},z,u),A.width=A.width-w.right-w.left,A.height=A.height-w.top-w.bottom,A.enableTooltips&&d(),A.enableInnerArcs&&e(),F=d3.layout.tree().nodeSize([2,10]).separation(function(a,b){var c=h(a)+h(b),d=c/2+4;return a.parent===b.parent?d:d+4}),H=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),I=d3.scale.linear().range([A.minNodeSize,A.maxNodeSize]),K=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",function(){L.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}),L=d3.select(a).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("viewBox","0 0 "+(A.width+w.right+w.left)+" "+(A.height+w.top+w.bottom)).attr("width",A.width+w.right+w.left).attr("height",A.height+w.top+w.bottom).call(K).append("g").attr("transform","translate("+w.left+","+w.top+")").append("g"),f(M.createNode(b))}function d(){G=d3.select("body").append("div").attr("id",a.id+"-tooltip").attr("class","tip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background-color","white").style("padding","2px").style("border","1px solid #dddddd").style("border-radius","3px;")}function e(){var a=d3.scale.linear().range([0,2*Math.PI]);J=d3.svg.arc().outerRadius(h).startAngle(0).endAngle(function(b){return a(b.data.self_count/b.data.count)||0})}function f(a){var b=this;I.domain([0,a.data.count]),E=a,E.x0=A.height/2,E.y0=0,E.setSelected(!0),E.children.forEach(function(a,c){a.color=d3.functor(A.colors).call(b,a,c),a.setRecursiveProperty("color",a.color)}),A.enableExpandOnClick?(E.collapseAll(),E.expand()):E.expandAll(),g(E),l(E)}function g(a){var b=F.nodes(E).reverse(),c=F.links(b);b.forEach(function(a){a.y=a.depth*A.nodeDistance});var d=L.selectAll("g.node").data(b,function(a){return a.id||(a.id=++D)}),e=d.enter().append("g").attr("class","node").style("cursor","pointer").attr("transform",function(b){return"translate("+(a.y||0)+","+(a.x0||0)+")"}).on("click",i).on("mouseover",m).on("mouseout",n).on("contextmenu",j);e.append("circle").attr("r",1e-6).style("stroke-width","1.5px").style("stroke",A.nodeStrokeColor).style("fill",A.nodeFillColor),A.enableInnerArcs&&e.append("path").attr("d",J).style("fill",A.nodeStrokeColor).style("fill-opacity",0),A.enableLabels&&e.append("text").attr("x",function(a){return a.isLeaf()?-10:10}).attr("dy",".35em").attr("text-anchor",function(a){return a.isLeaf()?"end":"start"}).text(A.getLabel).style("font","10px sans-serif").style("fill-opacity",1e-6);var f=d.transition().duration(x).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});f.select("circle").attr("r",h).style("fill-opacity",function(a){return a._children?1:0}).style("stroke",A.nodeStrokeColor).style("fill",A.nodeFillColor),A.enableLabels&&f.select("text").style("fill-opacity",1),A.enableInnerArcs&&f.select("path").duration(x).attr("d",J).style("fill-opacity",.8);var g=d.exit().transition().duration(x).attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).remove();g.select("circle").attr("r",1e-6),g.select("path").style("fill-opacity",1e-6),g.select("text").style("fill-opacity",1e-6);var k=L.selectAll("path.link").data(c,function(a){return a.target.id});k.enter().insert("path","g").attr("class","link").style("fill","none").style("stroke-opacity","0.5").style("stroke-linecap","round").style("stroke",A.linkStrokeColor).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x0||0,y:a.y0||0};return H({source:c,target:c})}),k.transition().duration(x).attr("d",H).style("stroke",A.linkStrokeColor).style("stroke-width",function(a){return a.source.selected?I(a.target.data.count)+"px":"4px"}),k.exit().transition().duration(x).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x,y:a.y};return H({source:c,target:c})}).remove(),b.forEach(function(a){var b=[a.x,a.y];a.x0=b[0],a.y0=b[1]})}function h(a){return a.selected?I(a.data.count)/2:2}function i(a){A.enableExpandOnClick&&(d3.event.defaultPrevented||(d3.event.shiftKey?a.expandAll():a.children?a.collapse():a.expand(),g(a),l(a)))}function j(a){A.enableRightClick&&k(a)}function k(a){return a===B&&a!==E?void k(E):(B=a,E.setSelected(!1),a.setSelected(!0),I.domain([0,a.data.count]),a.expand(),null!==d3.event&&d3.event.preventDefault(),g(a),void l(a))}function l(a){var b=K.scale(),c=-a.y0,d=-a.x0;c=c*b+A.width/4,d=d*b+A.height/2,L.transition().duration(x).attr("transform","translate("+c+","+d+")scale("+b+")"),K.scale(b),K.translate([c,d])}function m(a,b){A.enableTooltips&&(G.html(A.getTooltip(a)).style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px"),C=setTimeout(function(){G.style("visibility","visible")},1e3))}function n(a,b){A.enableTooltips&&(clearTimeout(C),G.style("visibility","hidden"))}function o(a){return a.selected?a._children?a.color||"#aaa":"#fff":"#aaa"}function p(a){return a.selected?a.color||"#aaa":"#aaa"}function q(a){return a.source.selected?a.target.color:"#aaa"}function r(a){return"<h3 class='tip-title'>"+A.getTooltipTitle(a)+"</h3><p>"+A.getTooltipText(a)+"</p>"}function s(a){return a.name}function t(a){return a.data.count+" hits"}var u=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],v={},w={top:5,right:5,bottom:5,left:5},x=750,y=d3.scale.category10(),z={height:300,width:600,nodeDistance:180,levelsToExpand:2,minNodeSize:2,maxNodeSize:105,countAccessor:function(a){return a.data.count},colors:function(a){return y(a.name)},nodeFillColor:o,nodeStrokeColor:p,linkStrokeColor:q,enableInnerArcs:!0,enableExpandOnClick:!0,enableRightClick:!0,enableLabels:!0,getLabel:function(a){return a.name},enableTooltips:!0,getTooltip:r,getTooltipTitle:s,getTooltipText:t},A=void 0,B=void 0,C=void 0,D=0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0,K=void 0,L=void 0,M=function(){function a(){_classCallCheck(this,a),this.data={}}return _createClass(a,[{key:"setCount",value:function(){A.countAccessor(this)?this.data.count=A.countAccessor(this):this.children?this.data.count=this.children.reduce(function(a,b){return a+b.data.count},0):this.data.count=0}},{key:"setRecursiveProperty",value:function(a,b){this[a]=b,this.children?this.children.forEach(function(c){c.setRecursiveProperty(a,b)}):this._children&&this._children.forEach(function(c){c.setRecursiveProperty(a,b)})}},{key:"isLeaf",value:function(){return this.children||this._children}},{key:"setSelected",value:function(a){this.setRecursiveProperty("selected",a)}},{key:"collapseAll",value:function(){this.children&&0===this.children.length&&(this.children=null),this.children&&(this._children=this.children,this._children.forEach(function(a){a.collapseAll()}),this.children=null)}},{key:"collapse",value:function(){this.children&&(this._children=this.children,this.children=null)}},{key:"expandAll",value:function(){this.expand(100)}},{key:"expand",value:function(){var a=arguments.length<=0||void 0===arguments[0]?A.levelsToExpand:arguments[0];a>0&&(this._children&&(this.children=this._children,this._children=null),this.children&&this.children.forEach(function(b){b.expand(a-1)}))}}],[{key:"createNode",value:function(b){b.children&&(b.children=b.children.map(function(b){return a.createNode(b)}));var c=_extends(new a,b);return c.setCount(),c}}]),a}();return v.reset=function(){K.scale(1),k(E)},c(),v};$.fn.treeview=a,$.fn.treeview.Constructor=b}();