/*! unipept-visualizations 23-06-2016 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){function a(a){return this.each(function(){var c=$(this),d=c.data("vis.treeview"),e=$.extend({},b.DEFAULTS,c.data(),"object"===("undefined"==typeof a?"undefined":_typeof(a))&&a);d||c.data("vis.treeview",d=new b(this,e)),"string"==typeof a&&d[a]()})}var b=function(a,b){function c(){p=b.width-n.right-n.left,q=b.height-n.top-n.bottom,x=d3.format(",d"),w=d3.select("body").append("div").attr("id",a.id+"-tooltip").attr("class","tip").style("position","absolute").style("z-index","10").style("visibility","hidden"),v=d3.layout.tree().nodeSize([2,10]).separation(function(a,b){var c=f(a)+f(b),d=c/2+4;return a.parent===b.parent?d:d+4}),y=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),z=d3.scale.linear().range([2,105]),A=d3.scale.linear().range([0,2*Math.PI]),B=d3.svg.arc().outerRadius(f).startAngle(0).endAngle(g),C=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",function(){D.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}),D=d3.select(a).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("viewBox","0 0 "+(p+n.right+n.left)+" "+(q+n.top+n.bottom)).attr("width",p+n.right+n.left).attr("height",q+n.top+n.bottom).call(C).append("g").attr("transform","translate("+n.left+","+n.top+")").append("g"),d(b.data)}function d(a){function c(a,d,e){e?a.color=e:a.color=d3.functor(b.colors).call(this,a,d),a.children&&a.children.forEach(function(b){c(b,d,a.color)})}z.domain([0,a.data.count]),u=a,u.x0=q/2,u.y0=0,E.setVisible(u),u.children.forEach(function(a,b){c(a,b)}),E.collapseAll(u),E.expand(u),e(u),j(u)}function e(a){var c=v.nodes(u).reverse(),d=v.links(c);c.forEach(function(a){a.y=180*a.depth});var e=D.selectAll("g.node").data(c,function(a){return a.id||(a.id=++t)}),g=e.enter().append("g").attr("class","node").style("cursor","pointer").attr("transform",function(b){return"translate("+(a.y||0)+","+(a.x0||0)+")"}).on("click",h).on("mouseover",k).on("mouseout",l).on("contextmenu",i);g.append("circle").attr("r",1e-6).style("stroke-width","1.5px").style("stroke",b.nodeStrokeColor).style("fill",b.nodeFillColor),g.append("path").attr("d",B).style("fill",b.nodeStrokeColor).style("fill-opacity",0),g.append("text").attr("x",function(a){return E.isLeaf(a)?-10:10}).attr("dy",".35em").attr("text-anchor",function(a){return E.isLeaf(a)?"end":"start"}).text(function(a){return a.name}).style("font","10px sans-serif").style("fill-opacity",1e-6);var j=e.transition().duration(o).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});j.select("circle").attr("r",f).style("fill-opacity",function(a){return a._children?1:0}).style("stroke",b.nodeStrokeColor).style("fill",b.nodeFillColor),j.select("text").style("fill-opacity",1),j.select("path").duration(o).attr("d",B).style("fill-opacity",.8);var m=e.exit().transition().duration(o).attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).remove();m.select("circle").attr("r",1e-6),m.select("path").style("fill-opacity",1e-6),m.select("text").style("fill-opacity",1e-6);var n=D.selectAll("path.link").data(d,function(a){return a.target.id});n.enter().insert("path","g").attr("class","link").style("fill","none").style("stroke-opacity","0.5").style("stroke-linecap","round").style("stroke",b.linkStrokeColor).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x0||0,y:a.y0||0};return y({source:c,target:c})}),n.transition().duration(o).attr("d",y).style("stroke",b.linkStrokeColor).style("stroke-width",function(a){return a.source.selected?z(a.target.data.count)+"px":"4px"}),n.exit().transition().duration(o).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x,y:a.y};return y({source:c,target:c})}).remove(),c.forEach(function(a){var b=[a.x,a.y];a.x0=b[0],a.y0=b[1]})}function f(a){return a.selected?z(a.data.count)/2:2}function g(a){return A(a.data.self_count/a.data.count)||0}function h(a){d3.event.defaultPrevented||(d3.event.shiftKey?E.expandAll(a):a.children?E.collapse(a):E.expand(a),e(a),j(a))}function i(a){return a===r&&a!==u?void i(u):(r=a,E.setSelected(u,!1),E.setSelected(a,!0),z.domain([0,a.data.count]),E.expand(a),null!==d3.event&&d3.event.preventDefault(),e(a),void j(a))}function j(a){var b=C.scale(),c=-a.y0,d=-a.x0;c=c*b+p/4,d=d*b+q/2,D.transition().duration(o).attr("transform","translate("+c+","+d+")scale("+b+")"),C.scale(b),C.translate([c,d])}function k(a,b){w.html("<b>"+a.name+"</b> ("+a.data.rank+")<br/>\n                "+x(a.data.self_count?a.data.self_count:"0")+(a.data.self_count&&1===a.data.self_count?" sequence":" sequences")+" specific to this level<br/>\n                "+x(a.data.count?a.data.count:"0")+(a.data.count&&1===a.data.count?" sequence":" sequences")+" specific to this level or lower"),w.style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px"),s=setTimeout(function(){w.style("visibility","visible")},1e3)}function l(a,b){clearTimeout(s),w.style("visibility","hidden")}var m={},n={top:5,right:5,bottom:5,left:5},o=750,p=void 0,q=void 0,r=void 0,s=void 0,t=0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"isLeaf",value:function(a){return a.children||a._children}},{key:"setVisible",value:function(b){b.selected=!0,b.children&&b.children.forEach(a.setVisible)}},{key:"setSelected",value:function(b,c){b.selected=c,b.children?b.children.forEach(function(b){a.setSelected(b,c)}):b._children&&b._children.forEach(function(b){a.setSelected(b,c)})}},{key:"collapseAll",value:function(b){b.children&&0===b.children.length&&(b.children=null),b.children&&(b._children=b.children,b._children.forEach(a.collapseAll),b.children=null)}},{key:"collapse",value:function(a){a.children&&(a._children=a.children,a.children=null)}},{key:"expandAll",value:function(b){a.expand(b,30)}},{key:"expand",value:function(b){var c=arguments.length<=1||void 0===arguments[1]?2:arguments[1];c>0&&(b._children&&(b.children=b._children,b._children=null),b.children&&b.children.forEach(function(b){a.expand(b,c-1)}))}}]),a}();return m.reset=function(){C.scale(1),i(u)},c(),m};b.NODE_FILL_COLOR=function(a){return a.selected?a._children?a.color||"#aaa":"#fff":"#aaa"},b.NODE_STROKE_COLOR=function(a){return a.selected?a.color||"#aaa":"#aaa"},b.LINK_STROKE_COLOR=function(a){return a.source.selected?a.target.color:"#aaa"},b.DEFAULT_SCALE=d3.scale.category10(),b.DEFAULTS={height:100,width:200,colors:function(a){return b.DEFAULT_SCALE(a.name)},nodeFillColor:b.NODE_FILL_COLOR,nodeStrokeColor:b.NODE_STROKE_COLOR,linkStrokeColor:b.LINK_STROKE_COLOR},$.fn.treeview=a,$.fn.treeview.Constructor=b}();