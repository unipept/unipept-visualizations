/*! unipept-visualizations 25-06-2016 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};!function(){function a(a,c){return this.each(function(){var d=$(this),e=d.data("vis.treeview"),f=$.extend({},d.data(),"object"===("undefined"==typeof c?"undefined":_typeof(c))&&c);e||d.data("vis.treeview",e=new b(this,a,f)),"string"==typeof c&&e[c]()})}var b=function(a,b){function c(){z=_extends({},y,t),z.width=z.width-v.right-v.left,z.height=z.height-v.top-v.bottom,z.tooltips&&d(),z.innerArcs&&e(),E=d3.layout.tree().nodeSize([2,10]).separation(function(a,b){var c=h(a)+h(b),d=c/2+4;return a.parent===b.parent?d:d+4}),G=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),H=d3.scale.linear().range([2,105]),J=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",function(){K.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}),K=d3.select(a).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("viewBox","0 0 "+(z.width+v.right+v.left)+" "+(z.height+v.top+v.bottom)).attr("width",z.width+v.right+v.left).attr("height",z.height+v.top+v.bottom).call(J).append("g").attr("transform","translate("+v.left+","+v.top+")").append("g"),f(L.createNode(b))}function d(){F=d3.select("body").append("div").attr("id",a.id+"-tooltip").attr("class","tip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background-color","white").style("padding","2px").style("border","1px solid #dddddd").style("border-radius","3px;")}function e(){var a=d3.scale.linear().range([0,2*Math.PI]);I=d3.svg.arc().outerRadius(h).startAngle(0).endAngle(function(b){return a(b.data.self_count/b.data.count)||0})}function f(a){function b(a,c,d){d?a.color=d:a.color=d3.functor(z.colors).call(this,a,c),a.children&&a.children.forEach(function(d){b(d,c,a.color)})}H.domain([0,a.data.count]),D=a,D.x0=z.height/2,D.y0=0,D.setVisible(),D.children.forEach(function(a,c){b(a,c)}),D.collapseAll(),D.expand(),g(D),k(D)}function g(a){var b=E.nodes(D).reverse(),c=E.links(b);b.forEach(function(a){a.y=180*a.depth});var d=K.selectAll("g.node").data(b,function(a){return a.id||(a.id=++C)}),e=d.enter().append("g").attr("class","node").style("cursor","pointer").attr("transform",function(b){return"translate("+(a.y||0)+","+(a.x0||0)+")"}).on("click",i).on("mouseover",l).on("mouseout",m).on("contextmenu",j);e.append("circle").attr("r",1e-6).style("stroke-width","1.5px").style("stroke",z.nodeStrokeColor).style("fill",z.nodeFillColor),z.innerArcs&&e.append("path").attr("d",I).style("fill",z.nodeStrokeColor).style("fill-opacity",0),e.append("text").attr("x",function(a){return a.isLeaf()?-10:10}).attr("dy",".35em").attr("text-anchor",function(a){return a.isLeaf()?"end":"start"}).text(function(a){return a.name}).style("font","10px sans-serif").style("fill-opacity",1e-6);var f=d.transition().duration(w).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});f.select("circle").attr("r",h).style("fill-opacity",function(a){return a._children?1:0}).style("stroke",z.nodeStrokeColor).style("fill",z.nodeFillColor),f.select("text").style("fill-opacity",1),z.innerArcs&&f.select("path").duration(w).attr("d",I).style("fill-opacity",.8);var g=d.exit().transition().duration(w).attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).remove();g.select("circle").attr("r",1e-6),g.select("path").style("fill-opacity",1e-6),g.select("text").style("fill-opacity",1e-6);var k=K.selectAll("path.link").data(c,function(a){return a.target.id});k.enter().insert("path","g").attr("class","link").style("fill","none").style("stroke-opacity","0.5").style("stroke-linecap","round").style("stroke",z.linkStrokeColor).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x0||0,y:a.y0||0};return G({source:c,target:c})}),k.transition().duration(w).attr("d",G).style("stroke",z.linkStrokeColor).style("stroke-width",function(a){return a.source.selected?H(a.target.data.count)+"px":"4px"}),k.exit().transition().duration(w).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x,y:a.y};return G({source:c,target:c})}).remove(),b.forEach(function(a){var b=[a.x,a.y];a.x0=b[0],a.y0=b[1]})}function h(a){return a.selected?H(a.data.count)/2:2}function i(a){d3.event.defaultPrevented||(d3.event.shiftKey?a.expandAll():a.children?a.collapse():a.expand(),g(a),k(a))}function j(a){return a===A&&a!==D?void j(D):(A=a,D.setSelected(!1),a.setSelected(!0),H.domain([0,a.data.count]),a.expand(),null!==d3.event&&d3.event.preventDefault(),g(a),void k(a))}function k(a){var b=J.scale(),c=-a.y0,d=-a.x0;c=c*b+z.width/4,d=d*b+z.height/2,K.transition().duration(w).attr("transform","translate("+c+","+d+")scale("+b+")"),J.scale(b),J.translate([c,d])}function l(a,b){z.tooltips&&(F.html(z.getTooltip(a)).style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px"),B=setTimeout(function(){F.style("visibility","visible")},1e3))}function m(a,b){z.tooltips&&(clearTimeout(B),F.style("visibility","hidden"))}function n(a){return a.selected?a._children?a.color||"#aaa":"#fff":"#aaa"}function o(a){return a.selected?a.color||"#aaa":"#aaa"}function p(a){return a.source.selected?a.target.color:"#aaa"}function q(a){return"<h3 class='tip-title'>"+z.getTooltipTitle(a)+"</h3><p>"+z.getTooltipText(a)+"</p>"}function r(a){return a.name}function s(a){return a.data.count+" hits"}var t=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],u={},v={top:5,right:5,bottom:5,left:5},w=750,x=d3.scale.category10(),y={height:300,width:600,colors:function(a){return x(a.name)},nodeFillColor:n,nodeStrokeColor:o,linkStrokeColor:p,innerArcs:!0,tooltips:!0,getTooltip:q,getTooltipTitle:r,getTooltipText:s},z=void 0,A=void 0,B=void 0,C=0,D=void 0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0,K=void 0,L=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"isLeaf",value:function(){return this.children||this._children}},{key:"setVisible",value:function(){this.selected=!0,this.children&&this.children.forEach(function(a){a.setVisible()})}},{key:"setSelected",value:function(a){this.selected=a,this.children?this.children.forEach(function(b){b.setSelected(a)}):this._children&&this._children.forEach(function(b){b.setSelected(a)})}},{key:"collapseAll",value:function(){this.children&&0===this.children.length&&(this.children=null),this.children&&(this._children=this.children,this._children.forEach(function(a){a.collapseAll()}),this.children=null)}},{key:"collapse",value:function(){this.children&&(this._children=this.children,this.children=null)}},{key:"expandAll",value:function(){this.expand(30)}},{key:"expand",value:function(){var a=arguments.length<=0||void 0===arguments[0]?2:arguments[0];a>0&&(this._children&&(this.children=this._children,this._children=null),this.children&&this.children.forEach(function(b){b.expand(a-1)}))}}],[{key:"createNode",value:function(b){return b.children&&(b.children=b.children.map(function(b){return a.createNode(b)})),_extends(new a,b)}}]),a}();return u.reset=function(){J.scale(1),j(D)},c(),u};$.fn.treeview=a,$.fn.treeview.Constructor=b}();