/*! unipept-visualizations 21-06-2016 */
!function(){function a(a){return this.each(function(){var c=$(this),d=c.data("vis.treeview"),e=$.extend({},b.DEFAULTS,c.data(),"object"==typeof a&&a);d||c.data("vis.treeview",d=new b(this,e)),"string"==typeof a&&d[a]()})}var b=function(a,b){function c(){r={top:5,right:5,bottom:5,left:5},s=b.width-r.right-r.left,t=b.height-r.top-r.bottom,z=d3.format(",d"),y=d3.select("body").append("div").attr("id",a.id+"-tooltip").attr("class","tip").style("position","absolute").style("z-index","10").style("visibility","hidden"),x=d3.layout.tree().nodeSize([2,10]).separation(function(a,b){var c=f(a)+f(b),d=c/2+4;return a.parent===b.parent?d:d+4}),A=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),B=d3.scale.linear().range([2,105]),C=d3.scale.linear().range([0,2*Math.PI]),D=d3.svg.arc().outerRadius(f).startAngle(0).endAngle(g),E=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",n),F=d3.select(a).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("viewBox","0 0 "+(s+r.right+r.left)+" "+(t+r.top+r.bottom)).attr("width",s+r.right+r.left).attr("height",t+r.top+r.bottom).call(E).append("g").attr("transform","translate("+r.left+","+r.top+")").append("g"),d(b.data)}function d(a){function c(a){a.selected=!0,a.children&&a.children.forEach(c)}function d(a,c,e){e?a.color=e:a.color=d3.functor(b.colors).call(this,a,c),a.children&&a.children.forEach(function(b){d(b,c,a.color)})}function f(a){a.children&&0===a.children.length&&(a.children=null),a.children&&(a._children=a.children,a._children.forEach(f),a.children=null)}B.domain([0,a.data.count]),w=a,w.x0=t/2,w.y0=0,c(w),w.children.forEach(function(a,b){d(a,b)}),f(w),j(w),e(w),o(w)}function e(a){var c=x.nodes(w).reverse(),d=x.links(c);c.forEach(function(a){a.y=180*a.depth});var e=F.selectAll("g.node").data(c,function(a){return a.id||(a.id=++H)}),g=e.enter().append("g").attr("class","node").style("cursor","pointer").attr("transform",function(b){return"translate("+(a.y||0)+","+(a.x0||0)+")"}).on("click",l).on("mouseover",p).on("mouseout",q).on("contextmenu",m);g.append("circle").attr("r",1e-6).style("stroke-width","1.5px").style("stroke",b.nodeStrokeColor).style("fill",b.nodeFillColor),g.append("path").attr("d",D).style("fill",b.nodeStrokeColor).style("fill-opacity",0),g.append("text").attr("x",function(a){return h(a)?-10:10}).attr("dy",".35em").attr("text-anchor",function(a){return h(a)?"end":"start"}).text(function(a){return a.name}).style("font","10px sans-serif").style("fill-opacity",1e-6);var i=e.transition().duration(I).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});i.select("circle").attr("r",f).style("fill-opacity",function(a){return a._children?1:0}).style("stroke",b.nodeStrokeColor).style("fill",b.nodeFillColor),i.select("text").style("fill-opacity",1),i.select("path").duration(I).attr("d",D).style("fill-opacity",.8);var j=e.exit().transition().duration(I).attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).remove();j.select("circle").attr("r",1e-6),j.select("path").style("fill-opacity",1e-6),j.select("text").style("fill-opacity",1e-6);var k=F.selectAll("path.link").data(d,function(a){return a.target.id});k.enter().insert("path","g").attr("class","link").style("fill","none").style("stroke-opacity","0.5").style("stroke-linecap","round").style("stroke",b.linkStrokeColor).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x0||0,y:a.y0||0};return A({source:c,target:c})}),k.transition().duration(I).attr("d",A).style("stroke",b.linkStrokeColor).style("stroke-width",function(a){return a.source.selected?B(a.target.data.count)+"px":"4px"}),k.exit().transition().duration(I).style("stroke-width",1e-6).attr("d",function(b){var c={x:a.x,y:a.y};return A({source:c,target:c})}).remove(),c.forEach(function(a){a.x0=a.x,a.y0=a.y})}function f(a){return a.selected?B(a.data.count)/2:2}function g(a){return C(a.data.self_count/a.data.count)||0}function h(a){return a.children||a._children}function i(a){j(a,30)}function j(a,b){var c=b;"undefined"==typeof c&&(c=2),c>0&&(a._children&&(a.children=a._children,a._children=null),a.children&&a.children.forEach(function(a){j(a,c-1)}))}function k(a){a.children&&(a._children=a.children,a.children=null)}function l(a){d3.event.defaultPrevented||(d3.event.shiftKey?i(a):a.children?k(a):j(a),e(a),o(a))}function m(a){function b(a,c){a.selected=c,a.children?a.children.forEach(function(a){b(a,c)}):a._children&&a._children.forEach(function(a){b(a,c)})}return a===u&&a!==w?void m(w):(u=a,b(w,!1),b(a,!0),B.domain([0,a.data.count]),j(a),null!==d3.event&&d3.event.preventDefault(),e(a),void o(a))}function n(){F.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function o(a){var b=E.scale(),c=-a.y0,d=-a.x0;c=c*b+s/4,d=d*b+t/2,F.transition().duration(I).attr("transform","translate("+c+","+d+")scale("+b+")"),E.scale(b),E.translate([c,d])}function p(a,b){y.html("<b>"+a.name+"</b> ("+a.data.rank+")<br/>"+z(a.data.self_count?a.data.self_count:"0")+(a.data.self_count&&1===a.data.self_count?" sequence":" sequences")+" specific to this level<br/>"+z(a.data.count?a.data.count:"0")+(a.data.count&&1===a.data.count?" sequence":" sequences")+" specific to this level or lower"),y.style("top",d3.event.pageY-5+"px").style("left",d3.event.pageX+15+"px"),v=setTimeout(function(){y.style("visibility","visible")},1e3)}function q(a,b){clearTimeout(v),y.style("visibility","hidden")}var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G={},H=0,I=750;return G.reset=function(){E.scale(1),m(w)},c(),G};b.NODE_FILL_COLOR=function(a){return a.selected?a._children?a.color||"#aaa":"#fff":"#aaa"},b.NODE_STROKE_COLOR=function(a){return a.selected?a.color||"#aaa":"#aaa"},b.LINK_STROKE_COLOR=function(a){return a.source.selected?a.target.color:"#aaa"},b.DEFAULT_SCALE=d3.scale.category10(),b.DEFAULTS={height:100,width:200,colors:function(a){return b.DEFAULT_SCALE(a.name)},nodeFillColor:b.NODE_FILL_COLOR,nodeStrokeColor:b.NODE_STROKE_COLOR,linkStrokeColor:b.LINK_STROKE_COLOR},$.fn.treeview=a,$.fn.treeview.Constructor=b}();